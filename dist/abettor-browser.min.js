/*!
 * The MIT License
 * 
 * Copyright (c) 2017 te schultz
 * https://github.com/artisin/abettor
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.abettor=e():t.abettor=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,n){function r(o,i){try{var a=e[o](i),c=a.value}catch(t){return void n(t)}if(!a.done)return Promise.resolve(c).then(function(t){r("next",t)},function(t){r("throw",t)});t(c)}return r("next")})}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n(1);var u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),e=Object.assign({typeCheck:!0,async:!0,blocking:!1},e),this.events={},this.queue=[],this.inAction=!1,this.async=e.async,this.blocking=e.blocking,this.typeCheck=e.typeCheck}return c(t,[{key:"emit",value:function(){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.typeCheck&&!(r=this._check({val:r,msg:'First argument for the "event" method'})))return this;var i=this._config(r,e);e=i.args;var a=i.events,c=i.async;return a&&a.length?!1!==c&&this.async?this._emitAsync.apply(this,[a,r].concat(o(e||[]))):(this.queue.push({fn:this._emitSync,events:a,event:r,args:e||[]}),this._checkQueue()):void 0}},{key:"on",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.typeCheck&&(t=this._check({val:t,msg:'First argument for the "on" method'}),e=this._check({val:e,type:"function",msg:'Second argument for the "on" method'})),t&&e){n=Object.assign({once:!1,args:[],order:null},n),e.__AbettorOpt__=n;var r=n.order;if(this.events[t]=this.events[t]?this.events[t]:[],null===r)this.events[t]=this.events[t].push(e)&&this.events[t];else if(-1===r)this.events[t]=this.events[t].unshift(e)&&this.events[t];else{this.events[t].length<r&&(this.events[t].length=r);this.events[t]=function(t,e,n){return void 0===t[e]?(t[e]=n,t):[].concat(o(t.slice(0,e)),[n],o(t.slice(e)))}(this.events[t],r,e)}}return this}},{key:"remove",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.typeCheck&&(null!==t&&(t=this._check({val:t,msg:'First argument for the "delete" method'})),null!==e&&(e=this._check({val:e,type:["function","number"],msg:'Second argument for the "delete" method'}))),null===t?this.events={}:null===e?this.events[t]&&delete this.events[t]:this.events[t]&&(Number.isInteger(e)?this.events[t].splice(e,1):this.events[t].splice(this.events[t].indexOf(e),1)),this}},{key:"snapshot",value:function(){for(var t=arguments.length,e=Array(t>2?t-2:0),n=2;n<t;n++)e[n-2]=arguments[n];var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this;i.typeCheck&&(null!==o&&(o=i._check({val:o,msg:'First argument for the "snapshot" method'})),null!==r&&(r=i._check({val:r,msg:'Section argument for the "snapshot" method'})));var a=i[o].bind(i);if(i.typeCheck&&!a&&(a=i._check({val:a,type:"function",msg:'Snapshot method not found for "'+o+'" which'})),r&&a){var c=i.events[r].slice(0);return function(){if("remove"===o)for(var t=0;t<c.length;t++)a(r,c[t]);else"emit"===o?(e.push({events:c}),a.apply(void 0,[r].concat(e))):a.apply(void 0,[r].concat(e))}}return i}},{key:"_check",value:function(t){var e=t.val,n=void 0===e?null:e,r=t.type,o=void 0===r?"string":r,i=t.msg,c=void 0===i?"":i;o=Array.isArray(o)?o:[o];for(var u=null,s=0;s<o.length;s++){if((void 0===n?"undefined":a(n))===o[s])return n;u="Abettor Error: "+c+" must be a "+JSON.stringify(o)+"."}return u?(console.error(u),null):n}},{key:"_config",value:function(t,e){var n=e.length&&e[e.length-1],r={async:this.async,events:this.events[t],blocking:this.blocking};return Object.keys(r).forEach(function(t){n&&void 0!==n[t]&&(r[t]=n[t],1===Object.keys(n).length&&(e.pop(),n=e.length&&e[e.length-1]))}),r.args=e,r}},{key:"_checkQueue",value:function(){if(this.queue.length&&!this.inAction){var t=this.queue.shift();return t.fn.apply(this,[t.events,t.event].concat(o(t.args)))}return this}},{key:"_emitAsync",value:function(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];var c=this;t=t.slice(0);for(var u=t.length,s=i.length&&i[i.length-1],h=s&&s.done&&"function"==typeof s.done&&i.pop().done,l=[],f=function(){var t=r(regeneratorRuntime.mark(function t(n){var r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i||[],!n){t.next=6;break}return n.__AbettorOpt__.args.length&&(r=[].concat(o(n.__AbettorOpt__.args),o(r))),n.__AbettorOpt__.once&&l.push(function(){return c.remove(e,n)}),t.next=6,n.apply(void 0,o(r));case 6:if(0===--u)for(a=0;a<l.length;a++)l[a]();0===u&&h&&h();case 9:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),p=0;p<t.length;p++)f(t[p]);return c._checkQueue()}},{key:"_emitSync",value:function(t,e){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];var c=this;this.inAction=!0,t=t.slice(0);var u=i.length&&i[i.length-1],s=u&&u.done&&"function"==typeof u.done&&i.pop().done,h=[],l=function(){var t=r(regeneratorRuntime.mark(function t(e,n,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.apply(void 0,o(n));case 2:return t.abrupt("return",r());case 3:case"end":return t.stop()}},t,this)}));return function(e,n,r){return t.apply(this,arguments)}}(),f=function(t,e,n){return t.apply(void 0,o(e)),n()},p=function(t,n){var r=i||[];return t?(t.__AbettorOpt__.args.length&&(r=[].concat(o(t.__AbettorOpt__.args),o(r))),t.__AbettorOpt__.once&&h.push(function(){return c.remove(e,t)}),c.blocking||u.blocking?f(t,r,n):l(t,r,n)):n()};return function e(n){if(t[n])return p(t[n],function(){return e(++n)});for(var r=0;r<h.length;r++)h[r]();return s&&s(),c.inAction=!1,c._checkQueue()}(0)}}]),t}();t.exports=u},function(t,e,n){(function(e){!function(e){"use strict";function n(t,e,n,r){var i=e&&e.prototype instanceof o?e:o,a=Object.create(i.prototype),c=new p(r||[]);return a._invoke=s(t,n,c),a}function r(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function o(){}function i(){}function a(){}function c(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){function n(e,o,i,a){var c=r(t[e],t,o);if("throw"!==c.type){var u=c.arg,s=u.value;return s&&"object"==typeof s&&m.call(s,"__await")?Promise.resolve(s.__await).then(function(t){n("next",t,i,a)},function(t){n("throw",t,i,a)}):Promise.resolve(s).then(function(t){u.value=t,i(u)},a)}a(c.arg)}function o(t,e){function r(){return new Promise(function(r,o){n(t,e,r,o)})}return i=i?i.then(r,r):r()}"object"==typeof e.process&&e.process.domain&&(n=e.process.domain.bind(n));var i;this._invoke=o}function s(t,e,n){var o=O;return function(i,a){if(o===A)throw new Error("Generator is already running");if(o===E){if("throw"===i)throw a;return y()}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=h(c,n);if(u){if(u===S)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===O)throw o=E,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=A;var s=r(t,e,n);if("normal"===s.type){if(o=n.done?E:j,s.arg===S)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=E,n.method="throw",n.arg=s.arg)}}}function h(t,e){var n=t.iterator[e.method];if(n===g){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=g,h(t,e),"throw"===e.method))return S;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return S}var o=r(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,S;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=g),e.delegate=null,S):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,S)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function v(t){if(t){var e=t[_];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(m.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=g,e.done=!0,e};return r.next=r}}return{next:y}}function y(){return{value:g,done:!0}}var g,d=Object.prototype,m=d.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},_=b.iterator||"@@iterator",w=b.asyncIterator||"@@asyncIterator",k=b.toStringTag||"@@toStringTag",x="object"==typeof t,L=e.regeneratorRuntime;if(L)return void(x&&(t.exports=L));L=e.regeneratorRuntime=x?t.exports:{},L.wrap=n;var O="suspendedStart",j="suspendedYield",A="executing",E="completed",S={},P={};P[_]=function(){return this};var F=Object.getPrototypeOf,N=F&&F(F(v([])));N&&N!==d&&m.call(N,_)&&(P=N);var C=a.prototype=o.prototype=Object.create(P);i.prototype=C.constructor=a,a.constructor=i,a[k]=i.displayName="GeneratorFunction",L.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===i||"GeneratorFunction"===(e.displayName||e.name))},L.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,k in t||(t[k]="GeneratorFunction")),t.prototype=Object.create(C),t},L.awrap=function(t){return{__await:t}},c(u.prototype),u.prototype[w]=function(){return this},L.AsyncIterator=u,L.async=function(t,e,r,o){var i=new u(n(t,e,r,o));return L.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},c(C),C[k]="Generator",C[_]=function(){return this},C.toString=function(){return"[object Generator]"},L.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},L.values=v,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&m.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,r){return i.type="throw",i.arg=t,n.next=e,r&&(n.method="next",n.arg=g),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=m.call(o,"catchLoc"),c=m.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,S):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),S},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),S}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;f(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:v(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=g),S}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n}])});